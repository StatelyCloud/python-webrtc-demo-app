"""
Code generated by Stately. DO NOT EDIT.

This package contains a Schema specific client and types
for interacting with your Stately Store.
"""

# ruff: noqa: SIM103, A002, PLR0911, RET504, PLR0912, C901, PLR0913, E501, PLR0915
# ruff: noqa: B008 # remove this after refactoring default values

from __future__ import annotations

from enum import Enum
from uuid import UUID

from statelydb import AuthTokenProvider, StatelyItem, StatelyObject, StoreID
from statelydb import Client as SDKClient
from statelydb.lib.api.db.item_pb2 import Item as PBItem
from statelydb.src.keys import key_path
from statelydb.src.types import BaseTypeMapper

from . import schema_pb2


class Client(SDKClient):
    """
    Client is a Schema specific client for interacting with your Stately Store.
    This Client automatically marshals and unmarshals your Schema types into
    the wire format expected by the Stately API.
    """

    def __init__(
        self,
        store_id: StoreID,
        token_provider: AuthTokenProvider | None = None,
        endpoint: str = "https://api.stately.cloud",
    ) -> None:
        """
        Create a new Client.

        :param store_id: The ID of the store to connect to.
            All client operations will be performed on this
            store.
        :type store_id: StoreID

        :param token_provider: An optional token provider function for
            authenticating requests. Defaults to reading `STATELY_CLIENT_ID`
            and `STATELY_CLIENT_SECRET` from the environment.
        :type token_provider: AuthTokenProvider | None

        :param endpoint: The Stately endpoint to connect to.
            Defaults to "https://api.stately.cloud".
        :type endpoint: str

        """
        super().__init__(
            store_id,
            token_provider=token_provider,
            type_mapper=TypeMapper(),
            endpoint=endpoint,
        )



class Participant(StatelyItem):
    """Generated Participant object."""

    username: str
    room: str
    _joined: int
    session_id: UUID
    pending_sdp: list[str]

    def __init__(
        self,
        *,
        username: str,
        room: str,
        session_id: UUID,
        pending_sdp: list[str] = [],
    ) -> None:
        """Create a new Participant."""
        self.username = username
        self.room = room
        self._joined = 0
        self.session_id = session_id
        self.pending_sdp = pending_sdp

    def key_path(self) -> str:
        """
        Returns the key_path of the current
        Participant.
        """
        return key_path(
            "/Room-{room}/Participant-{username}",
            room=self.room,
            username=self.username,
        )

    @property
    def joined(self) -> int:
        """Get the joined readonly field."""
        return self._joined

    @staticmethod
    def item_type() -> str:
        """
        Returns the item type of Participant
        as a string.
        """
        return "Participant"

    def marshal(self) -> PBItem:
        """Marshal a Participant into a PBItem."""
        o = schema_pb2.Participant()
        o.username = self.username
        o.room = self.room
        o.joined = self.joined
        o.session_id = self.session_id.bytes
        o.pending_sdp.extend(self.pending_sdp)
        return PBItem(
            proto=o.SerializeToString(),
            item_type=self.item_type(),
        )

    def __eq__(self, other: object) -> bool:
        """
        Enables use of the `==` operator to compare
        Participant instances.
        """
        if not isinstance(other, self.__class__):
            return False
        return self.__dict__ == other.__dict__

    @staticmethod
    def unmarshal(proto_bytes: bytes) -> Participant:
        """
        Unmarshal schema_pb2.Participant
        bytes into a new Participant.
        """
        pb = schema_pb2.Participant.FromString(proto_bytes)
        o = Participant(
            username=pb.username,
            room=pb.room,
            session_id=UUID(bytes=pb.session_id),
            pending_sdp=list(pb.pending_sdp),
        )
        o._joined = pb.joined  # noqa: SLF001

        return o


class TypeMapper(BaseTypeMapper):
    """
    TypeMapper is a Schema specific type mapper for unmarshalling items from the Stately
    API into the Schema specific types found in this package.
    """

    @staticmethod
    def unmarshal(item: PBItem) -> StatelyItem:
        """Unmarshal a PBItem into a Schema specific type."""
        if item.item_type == "Participant":
            return Participant.unmarshal(item.proto)

        msg = f"Unknown item type: {item.item_type}"
        raise ValueError(msg)
